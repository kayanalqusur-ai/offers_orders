{% extends "base.html" %}

{% block title %}
{% if offer %}ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø¥ÙŠØ¬Ø§Ø± - {{ district_name }}{% else %}Ù†Ø´Ø± Ø¹Ø±Ø¶ Ø¥ÙŠØ¬Ø§Ø± Ø¬Ø¯ÙŠØ¯ - {{ district_name }}{% endif %}
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>
        <i class="fas fa-key"></i>
        {% if offer %}ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø¥ÙŠØ¬Ø§Ø± - {{ district_name }}{% else %}Ù†Ø´Ø± Ø¹Ø±Ø¶ Ø¥ÙŠØ¬Ø§Ø± Ø¬Ø¯ÙŠØ¯ - {{ district_name }}{% endif %}
    </h2>
    <hr>

    <form method="POST" 
          action="{% if offer %}{{ url_for('edit_rental' + district.replace('ÙˆØ³Ø·','m').replace('Ø¬Ù†ÙˆØ¨','w') + '_offer', offer_id=offer.id) }}{% else %}{{ url_for('add_rental' + district.replace('ÙˆØ³Ø·','m').replace('Ø¬Ù†ÙˆØ¨','w') + '_offer') }}{% endif %}" 
          enctype="multipart/form-data">

        <!-- Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø© -->
        <div class="mb-3">
            <label for="unit_type" class="form-label">Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø© <span class="text-danger">*</span></label>
            <input type="text" name="unit_type" id="unit_type" class="form-control" 
                   value="{{ offer.unit_type if offer else '' }}" required>
        </div>

        <!-- Ø§Ù„Ù…Ø³Ø§Ø­Ø© ÙˆØ§Ù„Ø·Ø§Ø¨Ù‚ -->
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="area" class="form-label">Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…Â²)</label>
                <input type="number" name="area" id="area" class="form-control" 
                       value="{{ offer.area if offer else '' }}">
            </div>
            <div class="col-md-6">
                <label for="floor" class="form-label">Ø§Ù„Ø·Ø§Ø¨Ù‚</label>
                <input type="text" name="floor" id="floor" class="form-control" 
                       value="{{ offer.floor if offer else '' }}">
            </div>
        </div>

        <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø± -->
        <div class="mb-3">
            <label for="details" class="form-label">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
            <textarea name="details" id="details" rows="3" class="form-control">{{ offer.details if offer else '' }}</textarea>
        </div>

        <!-- Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹ -->
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="price" class="form-label">Ø³Ø¹Ø± Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±</label>
                <input type="number" name="price" id="price" class="form-control" 
                       value="{{ offer.price if offer else '' }}">
            </div>
            <div class="col-md-6">
                <label for="location" class="form-label">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                <input type="text" name="location" id="location" class="form-control" 
                       placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø±ÙŠØ·Ø©" value="{{ offer.location if offer else '' }}">
            </div>
        </div>

        <!-- Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ù„Ùƒ -->
        <div class="mb-3">
    <label class="form-label">ØµÙØ© Ù…Ø§Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
<select id="owner_type" name="owner_type" class="form-select">
    <option value="">Ø§Ø®ØªØ±...</option>
    <option value="Ù…Ø§Ù„Ùƒ Ù…Ø¨Ø§Ø´Ø±" {% if offer and offer.owner_type == "Ù…Ø§Ù„Ùƒ Ù…Ø¨Ø§Ø´Ø±" %}selected{% endif %}>Ù…Ø§Ù„Ùƒ Ù…Ø¨Ø§Ø´Ø±</option>
    <option value="ÙˆØ³ÙŠØ·" {% if offer and offer.owner_type == "ÙˆØ³ÙŠØ·" %}selected{% endif %}>ÙˆØ³ÙŠØ·</option>
    <option value="ÙˆÙƒÙŠÙ„" {% if offer and offer.owner_type == "ÙˆÙƒÙŠÙ„" %}selected{% endif %}>ÙˆÙƒÙŠÙ„</option>
    <option value="other" {% if offer and offer.owner_type not in ["Ù…Ø§Ù„Ùƒ Ù…Ø¨Ø§Ø´Ø±","ÙˆØ³ÙŠØ·","ÙˆÙƒÙŠÙ„"] %}selected{% endif %}>Ø£Ø®Ø±Ù‰</option>
</select>

<input type="text" id="other_owner_type" 
       class="form-control mt-2" 
       placeholder="Ø£Ø¯Ø®Ù„ ØµÙØ© Ø§Ù„Ù…Ø§Ù„Ùƒ"
       value="{% if offer and offer.owner_type not in ['Ù…Ø§Ù„Ùƒ Ù…Ø¨Ø§Ø´Ø±','ÙˆØ³ÙŠØ·','ÙˆÙƒÙŠÙ„'] %}{{ offer.owner_type }}{% endif %}"
       style="display: none;">

</div>

        <!-- Ø§Ù„Ù…Ø³ÙˆÙ‚ -->
        <div class="mb-3">
            <label for="marketer" class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ÙˆÙ‚</label>
            <input type="text" name="marketer" id="marketer" class="form-control" 
                   value="{{ offer.marketer if offer else '' }}">
        </div>

        <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø¹Ø±Ø¶ -->
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="notes" class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                <textarea name="notes" id="notes" rows="2" class="form-control">{{ offer.notes if offer else '' }}</textarea>
            </div>
            <div class="col-md-6">
                <label for="status" class="form-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø±Ø¶</label>
                <select name="status" id="status" class="form-select">
                    {% set statuses = ['Ù…ØªØ§Ø­','Ø¹Ø±Ø¨ÙˆÙ†','ØºÙŠØ± Ù…ØªØ§Ø­'] %}
                    {% for st in statuses %}
                        <option value="{{ st }}" {% if offer and offer.status == st %}selected{% endif %}>{{ st }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± -->
                    <div class="mb-3">
                  <label class="form-label">ØµÙˆØ± Ø§Ù„Ø¹Ø±Ø¶ (1-5)</label>
                  {% for i in range(1, 6) %}
                    <input type="file" name="image{{ i }}" accept="image/*" class="form-control mb-1">
        
                   {% if offer and offer.images and offer.images|length >= i and offer.images[i-1] %}
                    <div class="mt-1">
                           <small>Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</small><br>
                        <img src="{{ offer.images[i-1] }}" class="img-thumbnail" style="width:150px; height:150px;" alt="ØµÙˆØ±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±">
                    </div>
                  {% endif %}
              {% endfor %}
         </div> 

        <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
        <button type="submit" class="btn btn-primary">
            {% if offer %}ğŸ’¾ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶{% else %}ğŸ“Œ Ù†Ø´Ø± Ø§Ù„Ø¹Ø±Ø¶{% endif %}
        </button>
        <a href="{% if district=='ÙˆØ³Ø·' %}{{ url_for('rentalm_offers') }}{% else %}{{ url_for('rentalw_offers') }}{% endif %}" class="btn btn-secondary">
            â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±
        </a>
    </form>
</div>

<script>
function toggleOtherOwnerType(select) {
    const otherInput = document.getElementById('other_owner_type');
    if (select.value === 'other') {
        otherInput.style.display = 'block';
        otherInput.name = 'owner_type'; // Ù†Ø±Ø³Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†Øµ ÙƒØµÙ†Ù Ø§Ù„Ù…Ø§Ù„Ùƒ
        select.name = 'owner_type_ignore'; // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
    } else {
        otherInput.style.display = 'none';
        otherInput.value = '';
        otherInput.name = 'owner_type_other'; // Ù„Ø§ ØªÙØ±Ø³Ù„
        select.name = 'owner_type'; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    }
}

window.addEventListener("DOMContentLoaded", function() {
    const select = document.getElementById('owner_type');
    toggleOtherOwnerType(select);
    select.addEventListener('change', function() {
        toggleOtherOwnerType(this);
    });
});

</script>
{% endblock %}
