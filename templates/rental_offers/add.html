{% extends "base.html" %}

{% block title %}
{% if offer %}ุชุนุฏูู ุนุฑุถ ุฅูุฌุงุฑ - {{ district_name }}{% else %}ูุดุฑ ุนุฑุถ ุฅูุฌุงุฑ ุฌุฏูุฏ - {{ district_name }}{% endif %}
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>
        <i class="fas fa-key"></i>
        {% if offer %}ุชุนุฏูู ุนุฑุถ ุฅูุฌุงุฑ - {{ district_name }}{% else %}ูุดุฑ ุนุฑุถ ุฅูุฌุงุฑ ุฌุฏูุฏ - {{ district_name }}{% endif %}
    </h2>
    <hr>

    <form method="POST" 
          action="{% if offer %}{{ url_for('edit_rental' + district.replace('ูุณุท','m').replace('ุฌููุจ','w') + '_offer', offer_id=offer.id) }}{% else %}{{ url_for('add_rental' + district.replace('ูุณุท','m').replace('ุฌููุจ','w') + '_offer') }}{% endif %}" 
          enctype="multipart/form-data">

        <!-- ููุน ุงููุญุฏุฉ -->
        <div class="mb-3">
            <label for="unit_type" class="form-label">ููุน ุงููุญุฏุฉ <span class="text-danger">*</span></label>
            <input type="text" name="unit_type" id="unit_type" class="form-control" 
                   value="{{ offer.unit_type if offer else '' }}" required>
        </div>

        <!-- ุงููุณุงุญุฉ ูุงูุทุงุจู -->
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="area" class="form-label">ุงููุณุงุญุฉ (ูยฒ)</label>
                <input type="number" name="area" id="area" class="form-control" 
                       value="{{ offer.area if offer else '' }}">
            </div>
            <div class="col-md-6">
                <label for="floor" class="form-label">ุงูุทุงุจู</label>
                <input type="text" name="floor" id="floor" class="form-control" 
                       value="{{ offer.floor if offer else '' }}">
            </div>
        </div>

        <!-- ุชูุงุตูู ุงูุนูุงุฑ -->
        <div class="mb-3">
            <label for="detalis" class="form-label">ุชูุงุตูู ุงูุนูุงุฑ</label>
            <textarea name="detalis" id="detalis" rows="3" class="form-control">{{ offer.detalis if offer else '' }}</textarea>
        </div>

        <!-- ุงูุณุนุฑ ูุงููููุน -->
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="price" class="form-label">ุณุนุฑ ุงูุฅูุฌุงุฑ</label>
                <input type="number" name="price" id="price" class="form-control" 
                       value="{{ offer.price if offer else '' }}">
            </div>
            <div class="col-md-6">
                <label for="location" class="form-label">ุงููููุน</label>
                <input type="text" name="location" id="location" class="form-control" 
                       placeholder="ุฑุงุจุท ุงูุฎุฑูุทุฉ" value="{{ offer.location if offer else '' }}">
            </div>
        </div>

        <!-- ููุน ุงููุงูู -->
        <div class="mb-3">
    <label class="form-label">ุตูุฉ ูุงูู ุงูุนูุงุฑ</label>
    <select id="owner_type" class="form-select">
        <option value="">ุงุฎุชุฑ...</option>
        <option value="ูุงูู ูุจุงุดุฑ" {% if offer and offer.owner_type == "ูุงูู ูุจุงุดุฑ" %}selected{% endif %}>ูุงูู ูุจุงุดุฑ</option>
        <option value="ูุณูุท" {% if offer and offer.owner_type == "ูุณูุท" %}selected{% endif %}>ูุณูุท</option>
        <option value="ูููู" {% if offer and offer.owner_type == "ูููู" %}selected{% endif %}>ูููู</option>
        <option value="other" {% if offer and offer.owner_type not in ["ูุงูู ูุจุงุดุฑ","ูุณูุท","ูููู"] %}selected{% endif %}>ุฃุฎุฑู</option>
    </select>

    <input type="text" id="other_owner_type" 
           class="form-control mt-2" 
           placeholder="ุฃุฏุฎู ุตูุฉ ุงููุงูู" 
           value="{% if offer and offer.owner_type not in ['ูุงูู ูุจุงุดุฑ','ูุณูุท','ูููู'] %}{{ offer.owner_type }}{% endif %}"
           style="display: none;">
</div>

        <!-- ุงููุณูู -->
        <div class="mb-3">
            <label for="marketer" class="form-label">ุงุณู ุงููุณูู</label>
            <input type="text" name="marketer" id="marketer" class="form-control" 
                   value="{{ offer.marketer if offer else '' }}">
        </div>

        <!-- ููุงุญุธุงุช ูุญุงูุฉ ุงูุนุฑุถ -->
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="notes" class="form-label">ููุงุญุธุงุช</label>
                <textarea name="notes" id="notes" rows="2" class="form-control">{{ offer.notes if offer else '' }}</textarea>
            </div>
            <div class="col-md-6">
                <label for="status" class="form-label">ุญุงูุฉ ุงูุนุฑุถ</label>
                <select name="status" id="status" class="form-select">
                    {% set statuses = ['ูุชุงุญ','ุนุฑุจูู','ุบูุฑ ูุชุงุญ'] %}
                    {% for st in statuses %}
                        <option value="{{ st }}" {% if offer and offer.status == st %}selected{% endif %}>{{ st }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- ุฑูุน ุงูุตูุฑ -->
        <div class="mb-3">
            <label class="form-label">ุตูุฑ ุงูุนุฑุถ (1-5)</label>
            {% for i in range(1,6) %}
                <input type="file" name="image{{ i }}" accept="image/*" class="form-control mb-1">
                {% if offer and offer.images and offer.images|length >= i %}
                    <div class="mt-1">
                        <small>ุงูุตูุฑุฉ ุงูุญุงููุฉ:</small><br>
                        <img src="{{ offer.images[i-1] }}" class="img-thumbnail" style="width:150px;height:150px;" alt="ุตูุฑุฉ ุงูุนูุงุฑ">
                    </div>
                {% endif %}
            {% endfor %}
        </div>

        <!-- ุงูุฃุฒุฑุงุฑ -->
        <button type="submit" class="btn btn-primary">
            {% if offer %}๐พ ุชุญุฏูุซ ุงูุนุฑุถ{% else %}๐ ูุดุฑ ุงูุนุฑุถ{% endif %}
        </button>
        <a href="{% if district=='ูุณุท' %}{{ url_for('rentalm_offers') }}{% else %}{{ url_for('rentalw_offers') }}{% endif %}" class="btn btn-secondary">
            โฌ ุงูุนูุฏุฉ ููุงุฆูุฉ ุนุฑูุถ ุงูุฅูุฌุงุฑ
        </a>
    </form>
</div>

<script>
function toggleOtherOwnerType(selectOrValue) {
    const otherInput = document.getElementById('other_owner_type');
    let value = typeof selectOrValue === 'string' ? selectOrValue : selectOrValue.value;

    if (value === 'other') {
        otherInput.style.display = 'block';
        otherInput.name = 'owner_type'; // ูุฅุฑุณุงู ุงููุต ูุตูู ุงููุงูู
    } else {
        otherInput.style.display = 'none';
        otherInput.value = '';
        otherInput.name = 'owner_type_other'; // ุชุฌุงูู ุงูุญูู
    }
}

// ุนูุฏ ุชุญููู ุงูุตูุญุฉ ูุชุญุฏูุฏ ุงููููุฉ ุงูุฃูููุฉ ูููุงูู
window.addEventListener("DOMContentLoaded", function() {
    const select = document.getElementById('owner_type');
    const initialValue = select.value;

    toggleOtherOwnerType(initialValue); // ุฅุฎูุงุก ุงููุฑุจุน ุฅุฐุง ูู ููู "ุฃุฎุฑู"

    select.addEventListener('change', function() {
        toggleOtherOwnerType(this.value);
    });
});
</script>
{% endblock %}
