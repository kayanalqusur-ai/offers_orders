<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">
    <style>
    body{font-family:'Cairo',sans-serif;background:#ecf0f1;margin:0}
    nav{background:#ecf0f1;padding:10px 40px}
    nav ul{display:flex;gap:20px;list-style:none;margin:0;padding:0}
    nav a{color:#2c3e50;text-decoration:none;font-weight:bold;padding:8px 15px;border-radius:8px;transition:.3s}
    nav a:hover{background:#3498db;color:#fff}
    .navbar{background:#34495e;color:#fff;padding:15px;text-align:center;font-size:24px}

        main { max-width:900px; margin:30px auto; background:white; padding:30px; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
        h2 { text-align:center; margin-bottom:20px; color:#34495e; }
        form { display:flex; flex-direction: column; gap:15px; margin-bottom:30px; }
        label { font-weight:bold; }
        input[type="text"], input[type="password"] { padding:10px; border-radius:8px; border:1px solid #ccc; font-size:14px; }
        .permissions { display:flex; flex-wrap:wrap; gap:10px; background:#f9f9f9; padding:15px; border-radius:8px; border:1px solid #ddd; }
        .permissions label { font-weight:normal; display:flex; align-items:center; }
        .permissions input[type="checkbox"] { margin-left:8px; }
        button { padding:12px; font-size:16px; background:#3498db; color:white; border:none; border-radius:10px; cursor:pointer; transition:0.3s; }
        button:hover { background:#2980b9; }
        table { width:100%; border-collapse: collapse; margin-top:20px; }
        th, td { border:1px solid #ddd; padding:12px; text-align:center; font-size:14px; }
        th { background:#3498db; color:white; }
        tr:nth-child(even) { background:#f9f9f9; }
        tr:hover { background:#f1f1f1; }
        .alert { padding:10px; margin-bottom:15px; border-radius:8px; color:white; background:#27ae60; display:none; text-align:center; }
        .badge { display:inline-block; background:#ecf0f1; padding:3px 6px; margin:2px; border-radius:6px; font-size:12px; }
    </style>
</head>
<body>

    <div class="navbar">ğŸ‘¥ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</div>

<nav>
    <ul>
        <li><a href="{{ url_for('dashboard') }}">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
        <li><a href="{{ url_for('list_employees') }}">Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</a></li>
        <li><a href="{{ url_for('rentalm_offers') }}">Ø¹Ø±ÙˆØ¶ ÙˆØ³Ø· Ø§Ù„Ø±ÙŠØ§Ø¶ Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±</a></li>
        <li><a href="{{ url_for('rentalw_offers') }}">Ø¹Ø±ÙˆØ¶ Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø±ÙŠØ§Ø¶ Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±</a></li>
        <li><a href="{{ url_for('salesm_offers') }}">Ø¹Ø±ÙˆØ¶ ÙˆØ³Ø· Ø§Ù„Ø±ÙŠØ§Ø¶ Ù„Ù„Ø¨ÙŠØ¹</a></li>
        <li><a href="{{ url_for('salesw_offers') }}">Ø¹Ø±ÙˆØ¶ Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø±ÙŠØ§Ø¶ Ù„Ù„Ø¨ÙŠØ¹</a></li>
        <li><a href="{{ url_for('orders') }}">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a></li>
        <li><a href="{{ url_for('view_logs') }}">Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</a></li>
        <li><a href="{{ url_for('logout') }}">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a></li>
    </ul>
</nav>

<main>
    <h2>Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</h2>

    <div class="alert" id="success-msg"></div>

    <form id="employee-form">
        <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù:</label>
        <input type="text" name="name" required>
        <label>Ø§Ù„Ø¯ÙˆØ±/Ø§Ù„ÙˆØ¸ÙŠÙØ©:</label>
        <input type="text" name="role" required>
        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
        <input type="text" name="username" required>
        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
        <input type="password" name="password" required autocomplete="off">

        <label>ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„:</label>
    <div class="permissions">
    {% set perms_map = {
        's_logs_view': 'Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª',
        's_employees_view': 'Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†',
        's_employees_add': 'Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù',
        's_employees_edit': 'ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ¸Ù',
        's_employees_delete': 'Ø­Ø°Ù Ù…ÙˆØ¸Ù',
        'rentalm_offers_view': 'Ø¹Ø±Ø¶ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± ÙˆØ³Ø· Ø§Ù„Ø±ÙŠØ§Ø¶',
        'rentalm_offers_add': 'Ø¥Ø¶Ø§ÙØ© Ø¹Ø±Ø¶ Ø¥ÙŠØ¬Ø§Ø± ÙˆØ³Ø· Ø§Ù„Ø±ÙŠØ§Ø¶',
        'rentalm_offers_edit': 'ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø¥ÙŠØ¬Ø§Ø± ÙˆØ³Ø· Ø§Ù„Ø±ÙŠØ§Ø¶',
        'rentalm_offers_delete': 'Ø­Ø°Ù Ø¹Ø±Ø¶ Ø¥ÙŠØ¬Ø§Ø± ÙˆØ³Ø· Ø§Ù„Ø±ÙŠØ§Ø¶',
        'rentalw_offers_view': 'Ø¹Ø±Ø¶ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø±ÙŠØ§Ø¶',
        'rentalw_offers_add': 'Ø¥Ø¶Ø§ÙØ© Ø¹Ø±Ø¶ Ø¥ÙŠØ¬Ø§Ø± Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø±ÙŠØ§Ø¶',
        'rentalw_offers_edit': 'ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø¥ÙŠØ¬Ø§Ø± Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø±ÙŠØ§Ø¶',
        'rentalw_offers_delete': 'Ø­Ø°Ù Ø¹Ø±Ø¶ Ø¥ÙŠØ¬Ø§Ø± Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø±ÙŠØ§Ø¶',
        'salesm_offers_view': 'Ø¹Ø±Ø¶ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ³Ø· Ø§Ù„Ø±ÙŠØ§Ø¶',
        'salesm_offers_add': 'Ø¥Ø¶Ø§ÙØ© Ø¹Ø±Ø¶ Ø¨ÙŠØ¹ ÙˆØ³Ø· Ø§Ù„Ø±ÙŠØ§Ø¶',
        'salesm_offers_edit': 'ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø¨ÙŠØ¹ ÙˆØ³Ø· Ø§Ù„Ø±ÙŠØ§Ø¶',
        'salesm_offers_delete': 'Ø­Ø°Ù Ø¹Ø±Ø¶ Ø¨ÙŠØ¹ ÙˆØ³Ø· Ø§Ù„Ø±ÙŠØ§Ø¶',
        'salesw_offers_view': 'Ø¹Ø±Ø¶ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¨ÙŠØ¹ Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø±ÙŠØ§Ø¶',
        'salesw_offers_add': 'Ø¥Ø¶Ø§ÙØ© Ø¹Ø±Ø¶ Ø¨ÙŠØ¹ Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø±ÙŠØ§Ø¶',
        'salesw_offers_edit': 'ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø¨ÙŠØ¹ Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø±ÙŠØ§Ø¶',
        'salesw_offers_delete': 'Ø­Ø°Ù Ø¹Ø±Ø¶ Ø¨ÙŠØ¹ Ø¬Ù†ÙˆØ¨ Ø§Ù„Ø±ÙŠØ§Ø¶',
        'orders': 'Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª',
        'orders_add': 'Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨',
        'orders_edit': 'ØªØ¹Ø¯ÙŠÙ„ Ø·Ù„Ø¨',
        'orders_delete': 'Ø­Ø°Ù Ø·Ù„Ø¨'
    } %}

    {% for perm, label in perms_map.items() %}
        <label>
            <input type="checkbox" name="permissions" value="{{ perm }}">
            {{ label }}
        </label>
    {% endfor %}
</div>
        <button type="submit">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù</button>
    </form>

    <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>
    <table id="employees-table">
        <thead>
            <tr>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
                <th>Ø§Ù„Ø¯ÙˆØ±</th>
                <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                <th>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</th>
            </tr>
        </thead>
        <tbody>
            {% for emp in employees %}
            <tr>
                <td>{{ emp.name }}</td>
                <td>{{ emp.role }}</td>
                <td>{{ emp.username }}</td>
                <td>
                    {% for p in emp.get_permissions() %}
                        <span class="badge">{{ p }}</span>
                    {% endfor %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</main>

<script>
document.getElementById('employee-form').addEventListener('submit', function(e){
    e.preventDefault();
    let formData = new FormData(this);
    // Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
    let perms = [];
    document.querySelectorAll('input[name="permissions"]:checked').forEach(cb => perms.push(cb.value));
    formData.delete('permissions');
    formData.append('permissions', JSON.stringify(perms));

    fetch('{{ url_for("list_employees") }}', {
        method: 'POST',
        body: formData
    }).then(res => res.json()).then(data => {
        if(data.success){
            let table = document.getElementById('employees-table').getElementsByTagName('tbody')[0];
            let row = table.insertRow();
            let permsHTML = '';
            JSON.parse(data.employee.permissions).forEach(p => { permsHTML += `<span class="badge">${p}</span>`; });
            row.innerHTML = `<td>${data.employee.name}</td><td>${data.employee.role}</td><td>${data.employee.username}</td><td>${permsHTML}</td>`;
            let msg = document.getElementById('success-msg');
            msg.innerText = "ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­";
            msg.style.display = 'block';
            this.reset();
        }
    });
});
</script>

</body>
</html>




