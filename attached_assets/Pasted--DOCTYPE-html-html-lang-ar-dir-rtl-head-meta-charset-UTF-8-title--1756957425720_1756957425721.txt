<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>إدارة الموظفين</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">
    <style>
    body{font-family:'Cairo',sans-serif;background:#ecf0f1;margin:0}
    nav{background:#ecf0f1;padding:10px 40px}
    nav ul{display:flex;gap:20px;list-style:none;margin:0;padding:0}
    nav a{color:#2c3e50;text-decoration:none;font-weight:bold;padding:8px 15px;border-radius:8px;transition:.3s}
    nav a:hover{background:#3498db;color:#fff}
    .navbar{background:#34495e;color:#fff;padding:15px;text-align:center;font-size:24px}

        main { max-width:900px; margin:30px auto; background:white; padding:30px; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
        h2 { text-align:center; margin-bottom:20px; color:#34495e; }
        form { display:flex; flex-direction: column; gap:15px; margin-bottom:30px; }
        label { font-weight:bold; }
        input[type="text"], input[type="password"] { padding:10px; border-radius:8px; border:1px solid #ccc; font-size:14px; }
        .permissions { display:flex; flex-wrap:wrap; gap:10px; background:#f9f9f9; padding:15px; border-radius:8px; border:1px solid #ddd; }
        .permissions label { font-weight:normal; display:flex; align-items:center; }
        .permissions input[type="checkbox"] { margin-left:8px; }
        button { padding:12px; font-size:16px; background:#3498db; color:white; border:none; border-radius:10px; cursor:pointer; transition:0.3s; }
        button:hover { background:#2980b9; }
        table { width:100%; border-collapse: collapse; margin-top:20px; }
        th, td { border:1px solid #ddd; padding:12px; text-align:center; font-size:14px; }
        th { background:#3498db; color:white; }
        tr:nth-child(even) { background:#f9f9f9; }
        tr:hover { background:#f1f1f1; }
        .alert { padding:10px; margin-bottom:15px; border-radius:8px; color:white; background:#27ae60; display:none; text-align:center; }
        .badge { display:inline-block; background:#ecf0f1; padding:3px 6px; margin:2px; border-radius:6px; font-size:12px; }
    </style>
</head>
<body>

    <div class="navbar">👥 إضافة موظف جديد</div>

<nav>
    <ul>
        <li><a href="{{ url_for('dashboard') }}">الرئيسية</a></li>
        <li><a href="{{ url_for('list_employees') }}">الموظفين</a></li>
        <li><a href="{{ url_for('rentalm_offers') }}">عروض وسط الرياض للإيجار</a></li>
        <li><a href="{{ url_for('rentalw_offers') }}">عروض جنوب الرياض للإيجار</a></li>
        <li><a href="{{ url_for('salesm_offers') }}">عروض وسط الرياض للبيع</a></li>
        <li><a href="{{ url_for('salesw_offers') }}">عروض جنوب الرياض للبيع</a></li>
        <li><a href="{{ url_for('orders') }}">الطلبات</a></li>
        <li><a href="{{ url_for('view_logs') }}">عرض السجلات</a></li>
        <li><a href="{{ url_for('logout') }}">تسجيل الخروج</a></li>
    </ul>
</nav>

<main>
    <h2>إضافة موظف جديد</h2>

    <div class="alert" id="success-msg"></div>

    <form id="employee-form">
        <label>اسم الموظف:</label>
        <input type="text" name="name" required>
        <label>الدور/الوظيفة:</label>
        <input type="text" name="role" required>
        <label>اسم المستخدم:</label>
        <input type="text" name="username" required>
        <label>كلمة المرور:</label>
        <input type="password" name="password" required autocomplete="off">

        <label>صلاحيات الوصول:</label>
    <div class="permissions">
    {% set perms_map = {
        's_logs_view': 'عرض السجلات',
        's_employees_view': 'عرض الموظفين',
        's_employees_add': 'إضافة موظف',
        's_employees_edit': 'تعديل موظف',
        's_employees_delete': 'حذف موظف',
        'rentalm_offers_view': 'عرض عروض الإيجار وسط الرياض',
        'rentalm_offers_add': 'إضافة عرض إيجار وسط الرياض',
        'rentalm_offers_edit': 'تعديل عرض إيجار وسط الرياض',
        'rentalm_offers_delete': 'حذف عرض إيجار وسط الرياض',
        'rentalw_offers_view': 'عرض عروض الإيجار جنوب الرياض',
        'rentalw_offers_add': 'إضافة عرض إيجار جنوب الرياض',
        'rentalw_offers_edit': 'تعديل عرض إيجار جنوب الرياض',
        'rentalw_offers_delete': 'حذف عرض إيجار جنوب الرياض',
        'salesm_offers_view': 'عرض عروض البيع وسط الرياض',
        'salesm_offers_add': 'إضافة عرض بيع وسط الرياض',
        'salesm_offers_edit': 'تعديل عرض بيع وسط الرياض',
        'salesm_offers_delete': 'حذف عرض بيع وسط الرياض',
        'salesw_offers_view': 'عرض عروض البيع جنوب الرياض',
        'salesw_offers_add': 'إضافة عرض بيع جنوب الرياض',
        'salesw_offers_edit': 'تعديل عرض بيع جنوب الرياض',
        'salesw_offers_delete': 'حذف عرض بيع جنوب الرياض',
        'orders': 'عرض الطلبات',
        'orders_add': 'إضافة طلب',
        'orders_edit': 'تعديل طلب',
        'orders_delete': 'حذف طلب'
    } %}

    {% for perm, label in perms_map.items() %}
        <label>
            <input type="checkbox" name="permissions" value="{{ perm }}">
            {{ label }}
        </label>
    {% endfor %}
</div>
        <button type="submit">إضافة الموظف</button>
    </form>

    <h2>قائمة الموظفين</h2>
    <table id="employees-table">
        <thead>
            <tr>
                <th>الاسم</th>
                <th>الدور</th>
                <th>اسم المستخدم</th>
                <th>الصلاحيات</th>
            </tr>
        </thead>
        <tbody>
            {% for emp in employees %}
            <tr>
                <td>{{ emp.name }}</td>
                <td>{{ emp.role }}</td>
                <td>{{ emp.username }}</td>
                <td>
                    {% for p in emp.get_permissions() %}
                        <span class="badge">{{ p }}</span>
                    {% endfor %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</main>

<script>
document.getElementById('employee-form').addEventListener('submit', function(e){
    e.preventDefault();
    let formData = new FormData(this);
    // جمع كل الصلاحيات المحددة
    let perms = [];
    document.querySelectorAll('input[name="permissions"]:checked').forEach(cb => perms.push(cb.value));
    formData.delete('permissions');
    formData.append('permissions', JSON.stringify(perms));

    fetch('{{ url_for("list_employees") }}', {
        method: 'POST',
        body: formData
    }).then(res => res.json()).then(data => {
        if(data.success){
            let table = document.getElementById('employees-table').getElementsByTagName('tbody')[0];
            let row = table.insertRow();
            let permsHTML = '';
            JSON.parse(data.employee.permissions).forEach(p => { permsHTML += `<span class="badge">${p}</span>`; });
            row.innerHTML = `<td>${data.employee.name}</td><td>${data.employee.role}</td><td>${data.employee.username}</td><td>${permsHTML}</td>`;
            let msg = document.getElementById('success-msg');
            msg.innerText = "تمت إضافة الموظف بنجاح";
            msg.style.display = 'block';
            this.reset();
        }
    });
});
</script>

</body>
</html>




